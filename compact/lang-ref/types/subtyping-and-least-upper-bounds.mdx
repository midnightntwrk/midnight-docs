# Subtyping and least upper bounds

There is a *subtyping* relation on Compact types.  Informally, if a type `T` is
a subtype of a type `S` then every value of type `T` is also a value of type `S`
(equivalently, `S` is a supertype of `T`).  In that case, Compact allows
implicitly using a value of type `T` where a value of type `S` is expected,
without any programmer-supplied conversion.

Subtyping is defined by the following rules:

- Any type `T` is a subtype of itself (subtyping is reflexive)
- `Uint<0..n>` is a subtype of `Uint<0..m>` if `n` is less than `m`
- `Uint<0..n>` is a subtype of `Field` for all `n`
- `[T, ...]` is a subtype of `[S, ...]` if the two tuple types have the length
  and each type `T` is a subtype of the corresponding type `S`

A circuit or witness can be called with argument expressions whose types are
subtypes of the corresponding parameter type annotations.  A constant binding
statement with a type annotation can be initialized with an expression whose
type is a subtype of the type annotation.

The *least upper bound* (with respect to subtyping) of a non-empty set of types
\{`T0`, ..., `Tn`} is a type `S` such that:

- **`S` is an upper bound:** `Ti` is a subtype of `S` for all `i` in
    the range 0..`n`, and
- **`S` is the least upper bound:** for all upper bounds `R` of the set of types
    \{`T0`, ..., `Tn`}, `S` is a subtype of `R`.

Note that least upper bounds do not necessarily exist for all sets of types.

**Tuple and vector types:** We say that a tuple type `[T, ...]` with possibly
distinct types `T, ...` "*has a vector type*" if the least upper bound `S` of
the set of types \{`T`, ...} exists.  In that case, the tuple type has the
vector type `Vector<n, S>` where `n` is the length of the tuple.  Some
operations over tuples (such as mapping and folding) require the tuple type to
have a vector type.

Note that when a tuple type has a vector type, the tuple type is a subtype of
the vector type.  Perhaps surprisingly, vector types can be subtypes of tuple
types as well.  A vector type `Vector<n, T>` is a subtype of a tuple type
`[S, ...]` if the tuple has length `n` and `T` is a subtype of each of the types
`S, ...`.  The means, for instance, that a vector could be passed to a circuit
where a tuple is expected.

