---
title: Set up Bun for Midnight development
description: Set up Bun package manager and the Compact compiler to build smart contracts and applications on the Midnight blockchain.
sidebar_label: Set up Bun for Midnight development
sidebar_position: 7
tags: [installation, bun, compact, setup]
slug: /how-to/bun-runtime-midnight
toc_max_heading_level: 2
---

# Set up Bun for Midnight development

Bun is a modern JavaScript runtime and toolkit that can offer significantly faster performance compared to Node.js and npm. This guide walks you through using Bun with Midnight Network development, covering installation, configuration, compatibility considerations, best practices, and much more.

By the end of this guide, you will:

- Install and configure Bun for Midnight development.
- Understand compatibility between Bun and Midnight's toolchain.
- Work with the Compact compiler using Bun.
- Troubleshoot common issues using Bun.

## Prerequisites

Before starting this guide, ensure you have:

- Basic knowledge of JavaScript/TypeScript
- Familiarity with command-line interfaces
- Understanding of package managers (npm, yarn)

:::note
Docker is not required for this tutorial. It's only needed when running actual Midnight proof servers.
:::

Here's what your complete project will look like by the end of this guide:

<img
  width="497"
  height="480"
  alt="Image"
  src="https://github.com/user-attachments/assets/3841162f-4485-47cc-98eb-4f9c1c786629"
/>

## Install Bun

In this section, you'll install Bun on your development machine.

### Install Bun on Mac

1.  Run the command below:

```bash
curl -fsSL https://bun.sh/install | bash
```

This script:

- Downloads the appropriate Bun binary for your system.
- Installs it to `~/.bun/bin`.

2. Verify the installation:

Close and reopen your terminal, then run:

```bash
bun --version
```

Example of expected output:

<img
  width="974"
  height="32"
  alt="Image"
  src="https://github.com/user-attachments/assets/2d817253-4b67-4c07-8562-c02a3db0e643"
/>

If bun --version returns "command not found." manually add Bun to your PATH.

```bash
export PATH="$HOME/.bun/bin:$PATH‚Äù
```

### Install Bun on linux or WSL

Follow the steps below to install Bun on Linux or Windows Subsystem for Linux (WSL).

1. Install required dependencies

Bun‚Äôs installer requires unzip to extract the binary.

```bash
sudo apt update
sudo apt install unzip -y
```

2. Install Bun

Run the official Bun installation script:

```
curl -fsSL https://bun.sh/install | bash
```

3. Reload your shell configuration

Update your environment so the bun command is available:

```bash
source ~/.bashrc
```

4. Verify the installation

```bash
bun --version
```

You should see the installed Bun version printed to the terminal.

5. Fix ‚Äúcommand not found‚Äù (if needed)

If bun is not found, add Bun‚Äôs install directory to your `PATH`:

```bash
export PATH="$HOME/.local/bin:$PATH"
```

## Install using the installer script

Here, you will install the Compact compiler. This is a standalone tool (separate from Bun) used to turn Compact smart contracts (written in the Compact language) into code that can run on the Midnight blockchain.

1. Install using the Compact installer:

```bash
curl --proto '=https' --tlsv1.2 -LsSf \
  https://github.com/midnightntwrk/compact/releases/latest/download/compact-installer.sh | sh
```

By default, the installer places the compact binary in `$HOME/.local/bin`

2.  Update the compiler

After installation, update the Compact compiler to the version used in this tutorial:

```bash
compact update 0.26.0
```

3. Verify the installation

Confirm that Compact is installed and correctly configured:

```bash
compact check
```

If the installation is successful, you should see output similar to the following:

<img
  width="1115"
  height="35"
  alt="Image"
  src="https://github.com/user-attachments/assets/ac6fcf15-821b-412d-b41c-1fe0a5cafb5d"
/>

4. Fix ‚Äúcommand not found‚Äù (PATH issue)

If you see an error such as:

```
compact: command not found
```

it means the directory where Compact was installed `($HOME/.local/bin)` is not included in your PATH.

Add it to your current terminal session:

```bash
export PATH="$HOME/.local/bin:$PATH"
```

## Install Midnight Packages with Bun

With both Bun and the Compact compiler installed, you can now create a Midnight application project.

1. Initialize a new project:

```bash
mkdir my-midnight-app
cd my-midnight-app
bun init -y
```

This creates a basic `package.json`.

2. Create the required directories:

The project requires separate folders for smart contracts and application source code.

```bash
mkdir src contracts
```

3. Install the Midnight runtime package

Install a specific version to avoid compatibility issues:

```bash
bun add @midnight-ntwrk/compact-runtime@0.9.0
```

This gives you everything you need to:

- Run your smart contracts
- Manage your app's data
- Work with zero-knowledge proofs
- Get type definitions for TypeScript

4. Update the `tsconfig.json` file:

```json title="tsconfig.json"
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "node",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "resolveJsonModule": true
  },
  "include": ["src/**/*"]
}
```

This configuration ensures:

- Bun can resolve imports correctly.
- TypeScript compiles cleanly.
- Midnight‚Äôs runtime packages work without extra setup.

## Configure the project

Update your `package.json` with the Bun-specific scripts below:

```json title="package.json"
  "scripts": {
    "dev": "bun run --hot src/index.ts",
    "start": "bun run dist/index.js",
    "test": "bun test",
    "install:midnight": "bun install",
    "compile:contract": "compact compile contracts/message.compact contracts/managed",
    "build:contract": "bun run compile:contract && bun build src/index.ts --outdir dist"
  },
```

Script explanations:

- dev: Runs the app in development mode with hot reload on src/index.ts.

- start: Runs the compiled production app from dist/index.js.

- test: Runs all tests using Bun‚Äôs test runner.

- install:midnight: Installs project dependencies with Bun.

- compile:contract: Compiles the Compact smart contract `message.compact` into the contracts/managed output directory.

- build:contract: First compiles the smart contract, then bundles the app entry file into the dist folder for production.

## Create smart contract with Compact

In this section, you will create a simple Compact smart contract that allows you to store and read a message on the Midnight blockchain. Then, you will compile it so it can be used in your TypeScript/Bun application.

1. Create the smart contract file.

Create a file named `message.compact` in the contracts directory:

```bash
touch contracts/message.compact
```

2. Add the code below to the file:

```compact title="message.compact"
pragma language_version 0.18;

import CompactStandardLibrary;

// Public ledger state - visible on blockchain
export ledger message: Opaque<"string">;

// Circuit to store a message on the blockchain
// The message will be publicly visible
export circuit storeMessage(customMessage: Opaque<"string">): [] {
    message = disclose(customMessage);
}

```

Explanation:

- `pragma language_version 0.18;`
  Specifies the exact Compact compiler version required for this smart contract. Using version 0.18 ensures compatibility with the runtime version 0.9.0 you installed earlier.
- `import CompactStandardLibrary;`
  Loads standard functions and types provided by Midnight for contracts.
- `export ledger message: Opaque<"string">;`
  Declares a public state variable called `message` on the blockchain. Its value will be visible to everyone.
- `export circuit storeMessage(customMessage: Opaque<"string">): [] { ... }`
  Defines a function (circuit) to store a message on the blockchain. `disclose()` makes the message publicly readable.

3. Compile with compact

```bash
compact compile contracts/message.compact contracts/managed
```

<img
  width="864"
  height="62"
  alt="Image"
  src="https://github.com/user-attachments/assets/b53eb5ae-3f37-489d-8b54-968f84748e7a"
/>

What this does:

- Converts the human-readable `.compact` contract into a compiled module that your application can interact with.
- Saves the compiled contract in `contracts/managed`, making it ready for integration with your Bun/TypeScript app.

## Integrate compiled smart contracts with Bun

Now that your Compact contracts are compiled, the next step is to interact with them from a Bun-powered TypeScript application.

Here you‚Äôll create a client that simulates storing and reading a message from your Midnight contract.

1. Create `src/message-client.ts`

```bash
touch src/message-client.ts
```

Add the following code:

```typescript title="message-client.ts"
import { Contract, ledger } from "../contracts/managed/contract/index.cjs";

export class MessageClient {
  private contract: Contract<any>;

  constructor() {
    this.contract = new Contract({});
  }

  async storeMessage(customMessage: string) {
    console.log(`üì¶ (Simulated) Storing message: "${customMessage}"`);
    // Real implementation needs proper Midnight context
    return { success: true, message: customMessage };
  }

  async getMessage() {
    console.log("üì• (Simulated) Fetching message from ledger...");
    return "Hello Midnight!";
  }
}
```

What this does:

- Creates a `MessageClient` class.
- Loads your compiled Compact contract.
- Provides two methods:
  - `storeMessage()`: simulates writing data.
  - `getMessage()`: simulates reading data.
- Keeps things simple while preserving the project structure required by real Midnight apps.

2. Create `src/index.ts`

This file will serve as your application entry point.

```bash
touch src/index.ts
```

Add the following code:

```typescript title="index.ts"
import { MessageClient } from "./message-client";

async function main() {
  console.log("üöÄ Starting Midnight Message App...");

  const client = new MessageClient();

  console.log("üìù Storing message...");
  await client.storeMessage("Hello Midnight!");

  console.log("üìñ Reading message...");
  const message = await client.getMessage();
  console.log("‚úÖ Message:", message);
}

main().catch(console.error);
```

### What this file does:

- Boot your Midnight app
- Creates an instance of `MessageClient`
- Calls the store and retrieves functions
- Prints the results nicely in your terminal

3. Run the app with Bun:

```bash
bun run --hot src/index.ts
```

<img
  width="587"
  height="128"
  alt="Image"
  src="https://github.com/user-attachments/assets/845d6cbf-fcf8-42e9-bfe7-a63a6859175a"
/>

## Known limitations and workarounds

While Bun offers significant performance improvements, there are some limitations you should be aware of when building Midnight applications. Here are the common issues and how to work around them.

### Native module compatibility

Issue:
some npm packages with native Node.js addons may not work correctly with Bun.

Workaround:

```bash
# If a package fails, try running it with Node.js compatibility mode
bun --bun run your-script.ts

# Or fall back to Node.js for specific scripts
node your-script.js
```

### Package manager lock files

Issue:
mixing Bun and npm in the same project can cause conflicts with lock files.

Workaround:

```bash
# Pick one and stick with it. If using Bun, remove npm files
rm package-lock.json

# If using npm, remove Bun files
rm bun.lock
```

:::tip
Choose one package manager for your project and have your team use only that one.
:::

### Environment variables

Issue:
bun automatically handles `.env` files, which might cause unexpected behavior if you're using other environment variable tools.

Workaround:

```bash
# Bun loads .env automatically, no library needed# If you need to disable this:
bun --env-file= run your-script.ts

# Or specify a different env file:
bun --env-file=.env.production run your-script.ts
```

## Migration guide (npm ‚Üí Bun)

If your Midnight project was originally set up using Node.js + npm, you can migrate to Bun with just a few steps. This guide walks you through the process safely and cleanly.

1. Install Bun

Make sure Bun is installed on your system.

To check

```bash
 bun --version
```

If not found, go to this step and [install Bun](#install-bun).

2. Remove npm Artifacts:

```bash
cd your-midnight-project
rm -rf node_modules package-lock.json
```

:::warning
Back up your `package-lock.json` first if you need to revert.
:::

3. Install dependencies with Bun:

```bash
bun install
```

4. Verify the Migration

Test that your application works correctly with Bun:

```bash
bun run dev
```

## Troubleshoot common issues

1. Module Not Found Errors

Problem:

```bash
bun run --hot src/index.ts
```

Cannot find module `'@midnight-ntwrk/compact-runtime‚Äô`

Solution:

```bash
bun add @midnight-ntwrk/compact-runtime@0.9.0
```

2. Version mismatch errors

Problem:

```bash
CompactError: Version mismatch: compiled code expects 0.9.0, runtime is 0.8.1
```

:::note
The Compact compiler and runtime versions must match exactly. Always check version compatibility before compiling.
:::

Solution:

Install the matching runtime version:

```bash
bun add @midnight-ntwrk/compact-runtime@0.9.0
```

Then recompile your smart contracts:

```bash
compact compile contracts/message.compact contracts/managed
```

3. Compact compiler language version errors

Problem:

```bash
Exception: message.compact line 1 char 1:
  language version 0.18.0 mismatch
```

Solution:

Update your smart contract to use the exact language version:

```compact
pragma language_version 0.18;
```

:::note
Using an exact version number (such as 0.18) instead of a range prevents compatibility issues with different compiler versions.
:::

4. Compact compiler installation issues

Problem:

The Compact compiler fails to install or doesn't work after installation.

Solutions:

- Verify the installer script ran successfully:

```bash
compact --version
```

- If the command isn't found, manually add it to your PATH:

```bash
export PATH="$HOME/.compact/bin:$PATH"
```

- Try reinstalling:

```bash
curl --proto '=https' --tlsv1.2 -LsSf \
  https://github.com/midnightntwrk/compact/releases/latest/download/compact-installer.sh | sh
```

## Conclusion

In this guide, you learned how to:

- Install and configure Bun as a drop-in replacement for Node.js.
- Use Bun to manage Midnight runtime packages.
- Compile Compact smart contracts using the Compact compiler.
- Set up a client app structure that integrates with compiled smart contracts.
- Migrate existing Midnight projects from npm to Bun safely.

For the next step, you can try interacting with real Midnight contracts, add wallet and proof-server support, and extend your Bun setup for bundling, testing, and production.

Related resources:

- [Bun documentation](https://bun.sh/docs)
- [Midnight installation guide](https://docs.midnight.network/getting-started/installation)
- [Compact language guide](https://docs.midnight.network/compact)
