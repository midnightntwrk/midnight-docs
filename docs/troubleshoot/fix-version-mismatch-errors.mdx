---
title: Fix version mismatch errors
description: Resolve version compatibility issues between Midnight compiler, runtime, and other components using the official compatibility matrix.
sidebar_label: Fix version mismatches
sidebar_position: 4
tags: [troubleshooting, version, compatibility, errors]
slug: /how-to/fix-version-mismatches
toc_max_heading_level: 2
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import Step, { StepsProvider } from "@site/src/components/Step/Step";

# Fix version mismatch errors

Learn how to resolve version compatibility issues between Midnight components that cause build failures and runtime errors.

## Understand the cause of version mismatches

Midnight consists of multiple components that must work together in compatible versions:

- **Compact toolchain**: Binaries, compiler, and formatter
- **Runtime libraries**: `@midnight-ntwrk/compact-runtime`, `@midnight-ntwrk/ledger-v7`, and related packages
- **JavaScript libraries**: `@midnight-ntwrk/midnight-js`, `@midnight-ntwrk/dapp-connector-api`, `@midnight-ntwrk/midnight-wallet-sdk-facade`, and related packages
- **Proof server**: Zero-knowledge proof generation service
- **Indexer**: GraphQL API for querying blockchain data (optional)

When these components are out of sync, you may encounter build errors, deployment failures, or runtime issues.

:::info Check the compatibility matrix
Always refer to the official [release compatibility matrix](/relnotes/support-matrix) to verify which versions work together.
:::

## Check your current versions

Before fixing version mismatches, identify which components are currently installed and compare them with the compatibility matrix.

<StepsProvider>

<Step>

### Check the compiler version

```bash
compact --version
```

Compare the output with the [compatibility matrix](/relnotes/support-matrix).

</Step>

<Step>

### Check runtime package versions

Run these commands to check the installed versions of runtime packages:

```bash
npm list @midnight-ntwrk/compact-runtime
npm list @midnight-ntwrk/ledger
npm list @midnight-ntwrk/zswap
```

Verify that all runtime packages use compatible version numbers as specified in the compatibility matrix.

</Step>

<Step>

### Check proof server version

If running the proof server using Docker:

```bash
docker ps | grep proof-server
docker logs [proof-server-container-id] | head -20
```

Look for version information in the startup logs.

</Step>

<Step>

### Compare versions with the compatibility matrix

Review the [release compatibility matrix](/relnotes/support-matrix) and verify your versions are compatible. Note any components that do not match the recommended versions.

</Step>

</StepsProvider>

## Align component versions

After identifying version mismatches, update all components to compatible versions. Always update related components together to maintain compatibility across your development environment.

<StepsProvider>

<Step>

### Consult the compatibility matrix

Review the [release compatibility matrix](/relnotes/support-matrix) to identify the correct versions for your components:

- Compact toolchain.
- Runtime libraries.
- JavaScript libraries.
- Proof server.
- Indexer (if used).

</Step>

<Step>

### Update runtime packages

Update your `package.json` with compatible versions from the matrix:

```json title="package.json"
{
  "dependencies": {
    "@midnight-ntwrk/compact-runtime": "x.x.x",
    "@midnight-ntwrk/ledger": "x.x.x",
    "@midnight-ntwrk/zswap": "x.x.x",
    "@midnight-ntwrk/wallet": "x.x.x"
  }
}
```

Install the updated packages:

```bash
npm install
```

</Step>

<Step>

### Update proof server

If you use Docker, update your container image to a compatible version. Stop the current container, update your `docker-compose.yml` with the correct version, then restart:

```bash
# Stop current container
docker-compose down

# Update docker-compose.yml with compatible version, then restart
docker-compose up -d
```

</Step>

<Step>

### Update the compiler

Download and install the compatible compiler version from the [Compact releases](https://github.com/midnightntwrk/compact/releases).

Verify installation:

```bash
compact --version
```

</Step>

<Step>

### Recompile contracts

After updating components, recompile your smart contracts:

```bash
# Clean old artifacts
rm -rf contract/managed/

# Recompile using direct compact command
compact compile src/contract.compact contract/managed
```

</Step>

</StepsProvider>

:::warning Keep components in sync
Always check the compatibility matrix when updating components. Update all related components together to maintain compatibility across your development environment.
:::

## Lock exact versions

Prevent automatic version updates by specifying exact version numbers in your project configuration. This ensures your project remains stable and avoids unexpected compatibility issues.

<StepsProvider>

<Step>

### Use exact version numbers

In your `package.json`, specify exact versions without range operators such as `^` or `~`:

```json title="package.json"
{
  "dependencies": {
    "@midnight-ntwrk/compact-runtime": "x.x.x",
    "@midnight-ntwrk/ledger": "x.x.x"
  }
}
```

:::caution Avoid version ranges
Do not use version range operators such as `^x.x.x` or `~x.x.x`. Always specify exact versions like `x.x.x` to prevent unexpected updates.
:::

</Step>

<Step>

### Use npm ci for installations

Use `npm ci` instead of `npm install` for reproducible builds:

```bash
# Clean install from lock file
rm -rf node_modules
npm ci
```

This installs exact versions from `package-lock.json`.

</Step>

<Step>

### Document your versions

Create a `VERSIONS.md` file in your project root to document the component versions you are using. This helps team members maintain consistency and troubleshoot version issues:

```markdown title="VERSIONS.md"
# Component Versions

Last verified: 2025-10-17

## Versions in Use

- Compact compiler: x.x.x
- Runtime packages: x.x.x
- Proof server: x.x.x
- Node.js: xx.x.x

## Compatibility Reference

See: /relnotes/support-matrix
```

</Step>

</StepsProvider>

## Platform-specific considerations

Different operating systems may require specific configuration or verification steps. Select your platform below for relevant guidance.

<Tabs>
<TabItem value="linux" label="Linux">

Ensure all components are properly installed and accessible:

```bash
# Check compiler location
which compact

# Verify Node.js version
node --version
```

</TabItem>
<TabItem value="mac" label="macOS">

On Apple Silicon (M1/M2/M3), verify that Docker images use the correct architecture:

```bash
# Check Docker architecture
docker info | grep Architecture
```

</TabItem>
<TabItem value="windows" label="Windows/WSL">

When using Windows Subsystem for Linux (WSL), use native WSL paths rather than Windows mount paths for better performance and consistency:

```bash
# Use native WSL paths, not Windows mount paths like /mnt/c/
cd /home/username/project

# Verify compiler access
compact --version
```

</TabItem>
</Tabs>

## Create a version check script

Create a simple shell script to automate version checking across your development environment. This script helps you quickly verify that all components match the compatibility matrix.

```bash title="check-versions.sh"
#!/bin/bash

echo "=== Midnight Version Check ==="
echo ""

echo "Compiler:"
compact --version || echo "❌ Compiler not found"
echo ""

echo "Runtime packages:"
npm list --depth=0 | grep @midnight-ntwrk || echo "❌ No Midnight packages found"
echo ""

echo "Node.js:"
node --version
echo ""

echo "⚠️  Compare these versions with:"
echo "/relnotes/support-matrix"
```

Make the script executable and run it:

```bash
chmod +x check-versions.sh
./check-versions.sh
```

## Back up before upgrading

Always back up your project files before upgrading components to prevent data loss if issues occur during the upgrade process:

```bash
# Back up package.json
cp package.json package.json.backup

# Back up contract artifacts
cp -r contract contract-backup

# Commit current state to git
git add -A
git commit -m "Backup before version upgrade"
```

## Verify after updates

After aligning component versions, test your setup to confirm everything works correctly:

```bash
# Test compilation
compact compile src/contract.compact contract/

# Run tests
npm test

# Check for errors
docker logs [proof-server-container-id]
```

## Common mistakes to avoid

Avoid these common errors when managing component versions:

:::caution

- **Don't mix version ranges**: Use exact versions only.
- **Don't update one component**: Update all related components together.
- **Don't skip the compatibility matrix**: Always verify compatibility first.
- **Don't forget to recompile**: Recompile contracts after compiler updates.
  :::

## Get help

If version issues persist after following these troubleshooting steps, use these resources:

1. **Check the compatibility matrix**: Review the [release compatibility matrix](/relnotes/support-matrix) for verified compatible versions.
2. **Review release notes**: Check component release notes for breaking changes and migration guidance.
3. **Ask for help**: Post in the #dev-chat channel on Discord with your version details and error messages.
